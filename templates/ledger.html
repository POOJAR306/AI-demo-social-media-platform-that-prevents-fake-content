<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Blockchain Ledger</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body { background-color: #f7f9fc; font-family: 'Segoe UI', sans-serif; }
        .container { margin-top: 40px; max-width: 1100px; }
        table { border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; table-layout: fixed; }
        thead { background-color: #007bff; color: white; }
        td, th { padding: 6px 8px !important; text-align: center; vertical-align: middle !important; }
        .hash { font-family: monospace; font-size: 0.75rem; word-break: break-all; }
        .status-badge { padding: 4px 8px; border-radius: 6px; color: white; font-weight: 600; font-size: 0.8rem; }
        .status-true { background-color: #dc3545; }
        .status-false { background-color: #28a745; }
        .filename-cell { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 180px; }
        .filename-cell:hover { overflow: visible; white-space: normal; background-color: #f8f9fa; position: relative; z-index: 2; }
        .filename-link { color: #007bff; text-decoration: none; }
        .filename-link:hover { text-decoration: underline; }
    </style>
</head>
<body>
<div class="container">
    <h2 class="mb-4 text-center">üîó Blockchain Ledger</h2>

    {% if entries %}
    <div class="table-responsive">
        <table class="table table-striped table-bordered align-middle">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Uploader</th>
                    <th>File</th>
                    <th>Type</th>
                    <th>Timestamp</th>
                    <th>Prev Hash</th>
                    <th>Hash</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for entry in entries %}
                <tr id="entry-{{ entry.id }}">
                    <td>{{ entry.id }}</td>
                    <td>{{ entry.uploader_id or 'N/A' }}</td>
                    <td class="filename-cell">
                        {% if entry.filename %}
                            <a href="{{ url_for('uploaded_file', filename=entry.filename) }}" class="filename-link" target="_blank">{{ entry.filename }}</a>
                        {% else %} ‚Äî {% endif %}
                    </td>
                    <td>{{ entry.content_type or '‚Äî' }}</td>
                    <td>{{ entry.timestamp }}</td>
                    <td class="hash text-muted">{{ entry.prev_hash or '‚Äî' }}</td>
                    <td class="hash">{{ entry.hash }}</td>
                    <td>
                        {% if entry.is_blocked %}
                            <span class="status-badge status-true">‚ùå Blocked</span>
                        {% else %}
                            <span class="status-badge status-false">‚úÖ Allowed</span>
                        {% endif %}
                    </td>
                    <td>
                        <button class="btn btn-sm btn-danger delete-btn" data-id="{{ entry.id }}">Delete</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <p class="text-center text-muted mt-5">No ledger entries yet.</p>
    {% endif %}
</div>

<script>
$(document).ready(function() {
    $('.delete-btn').click(function() {
        let entryId = $(this).data('id');
        if (confirm('Are you sure you want to delete this entry?')) {
            $.ajax({
                url: '/delete_entry/' + entryId,
                type: 'POST',
                success: function(response) {
                    if(response.success) {
                        $('#entry-' + entryId).fadeOut(500, function() { $(this).remove(); });
                    } else {
                        alert(response.message);
                    }
                },
                error: function() {
                    alert('Error deleting entry. Please try again.');
                }
            });
        }
    });
});
</script>
</body>
</html>
